<!doctypehtml><html lang=en><meta charset=UTF-8><title>MomBadge</title><style>pre{position:absolute;top:0%;left:50%;transform:translate(-50%,0);overflow-y:auto}</style><pre id=output>Loading...</pre><script src=https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js></script><script src=https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js></script><script>const firebaseConfig={apiKey:"",authDomain:"mom-badge-app.firebaseapp.com",projectId:"mom-badge-app",storageBucket:"mom-badge-app.appspot.com",messagingSenderId:"",appId:"",measurementId:""};firebase.initializeApp(firebaseConfig);const db=firebase.firestore();async function fetchMonthFromFile(){try{const e=await fetch("month.txt",{cache:"no-store"});if(!e.ok)throw new Error("Could not read month.txt");const t=await e.text(),o=parseInt(t.trim(),10);if(isNaN(o)||o<1||o>12)throw new Error("Invalid month in month.txt");return o}catch(e){throw console.error(e),document.getElementById("output").textContent="Error reading month.txt: "+e.message,e}}async function fetchVideoSenders(){const e=document.getElementById("output");e.textContent="Fetching data...\n";try{const t=await fetchMonthFromFile(),o=(new Date).getFullYear(),n=new Date(`${o}-${String(t).padStart(2,"0")}-01T00:00:00Z`),r=db.collection("badge_gifts"),a=await r.where("created_at",">=",n).get(),i=new Set;for(const e of a.docs){const t=e.data();if(!(!0===t.has_video))continue;let o=null;if(t.created_by_user_ref&&"function"==typeof t.created_by_user_ref.get)o=t.created_by_user_ref;else if("string"==typeof t.created_by_user_ref&&t.created_by_user_ref.includes("/")){const e=t.created_by_user_ref.split("/");o=db.collection(e[0]).doc(e[1])}if(o){const e=await o.get();if(e.exists){const t=e.data();t.email&&i.add(t.email)}}}0===i.size?e.textContent=`No users found with video gifts since ${o}-${String(t).padStart(2,"0")}-01.`:e.textContent=Array.from(i).join("\n")}catch(t){console.error(t),e.textContent="Error: "+t.message}}fetchVideoSenders()</script>
